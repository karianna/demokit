(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{146:function(e,t,i){"use strict";i.r(t),i.d(t,"frontMatter",(function(){return l})),i.d(t,"metadata",(function(){return s})),i.d(t,"rightToc",(function(){return r})),i.d(t,"default",(function(){return p}));var o=i(2),a=i(10),n=(i(0),i(163)),l={id:"github",title:"Github"},s={id:"kubernetes-devops/github",isDocsHomePage:!1,title:"Github",description:"Github devops demo leverages github actions to build application, generate image, push image to azure container registry, and deploy image to AKS. It includes",source:"@site/docs/kubernetes-devops/github.md",permalink:"/demokit/docs/kubernetes-devops/github",editUrl:"https://github.com/azure/demokit/edit/master/docs/kubernetes-devops/github.md",sidebar:"sidebar",previous:{title:"Arc for Kubernetes",permalink:"/demokit/docs/kubernetes-devops/arc-for-kubernetes"},next:{title:"Azure DevOps",permalink:"/demokit/docs/kubernetes-devops/devops"}},r=[],b={rightToc:r};function p(e){var t=e.components,i=Object(a.a)(e,["components"]);return Object(n.b)("wrapper",Object(o.a)({},b,i,{components:t,mdxType:"MDXLayout"}),Object(n.b)("p",null,"Github devops demo leverages github actions to build application, generate image, push image to azure container registry, and deploy image to AKS. It includes"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Github actions implemented pipleline"),Object(n.b)("li",{parentName:"ol"},"Canary deployment"),Object(n.b)("li",{parentName:"ol"},"Codeql to scan code triggered by push or schedule\nIt supports below scenarios"),Object(n.b)("li",{parentName:"ol"},"Devops pipeline \u2013 build & deploy"),Object(n.b)("li",{parentName:"ol"},"Canary Deployment in AKS"),Object(n.b)("li",{parentName:"ol"},"Rollback when deployment gets failed\nTo use this demo, follow below steps to open 3 webpages"),Object(n.b)("li",{parentName:"ol"},'Webpage 1(Ctrl+Click this URL), sample vote demo application, currently, its version is "Azure Voting App - Github Actions(v1)", please highlight it to your customer, later the version will get changed to "Azure Voting App \u2013 Github Actions(v2)"'),Object(n.b)("li",{parentName:"ol"},"Webpage 2(Ctrl+Click this URL), this is sample application configuration file, we are going to change the configuration, rebuild and deploy it to AKS."),Object(n.b)("li",{parentName:"ol"},"Webpage 3(Ctrl+Click this URL), github actions, this is the webpage that will show how build & deploy works here.\nDemo steps\nDevops Pipeline"),Object(n.b)("li",{parentName:"ol"},"Go to webpage 2, click edit icon and change TITLE from 'Azure Voting App - Github Actions(v1)' to ' Azure Voting App - Github Actions(v2)'"),Object(n.b)("li",{parentName:"ol"},"Click 'Commit changes' button to commit the change"),Object(n.b)("li",{parentName:"ol"},"Switch to webpage 3, refresh the page (might be multiple times), it will show github actions pipeline is started. It contains two actions, one is code scanning, another is build and deploy. "),Object(n.b)("li",{parentName:"ol"},'Click "Build and deploy" action, it has two stage, one is build and another is deploy, explain to your customer what github actions are doing right now, basically, it is building the code, pushing image to azure container registry, deploying the imaging to AKS'),Object(n.b)("li",{parentName:"ol"},"Once build & deploy is completed, go to page 1, refresh it, you will see it changed to 'Azure Voting App \u2013 Github Actions(v2)'")),Object(n.b)("p",null,"Canary Deployment in AKS"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Visit URL ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml"}),"https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml"),", uncomment below lines then commit the change to github"),Object(n.b)("li",{parentName:"ol"},"Visit URL ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://github.com/devopsonazure/vote-github/blob/master/azure-vote/config_file.cfg"}),"https://github.com/devopsonazure/vote-github/blob/master/azure-vote/config_file.cfg"),", modify version to v3, then commit change"),Object(n.b)("li",{parentName:"ol"},"Go to webpage 1, refresh page, the version of application should change to v3"),Object(n.b)("li",{parentName:"ol"},"Now, open a new browser and use in-private mode, paste and visit same URL from webpage 1, it should display v2"),Object(n.b)("li",{parentName:"ol"},"This is because we have enabled canary deployment, both versions exist in same cluster, AKS will handle the requests and distribute them to different version of services.  From AKS backend, it has two deploys\nkubectl get deploy -n github\nNAME                        READY   UP-TO-DATE   AVAILABLE   AGE\nazure-vote-back             1/1     1            1           3d23h\nazure-vote-front            1/1     1            1           3d19h\nazure-vote-front-baseline   1/1     1            1           22m\nazure-vote-front-canary     1/1     1            1           22m")),Object(n.b)("p",null,"Rollback"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Visit URL ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml"}),"https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml"),', add "_failed" into below line, then commit change to github, it will trigger a failed deployment'),Object(n.b)("li",{parentName:"ol"},"Go to ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://github.com/devopsonazure/vote-github/actions"}),"https://github.com/devopsonazure/vote-github/actions"),", click the newest Build and deploy link, you need to wait for some time until the deployment get failed, then show you to customer below screen, it shows after deploy failed, github action pipeline rolled back all changes."),Object(n.b)("li",{parentName:"ol"},"Go to webpage 1, refresh page, it will prove the service is still running and not affected by failed deployment.")))}p.isMDXComponent=!0}}]);